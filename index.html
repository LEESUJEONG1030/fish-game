<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì¿ ì•„ë¦¬ì›€ ì¹œêµ¬ë“¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes swim { 0% { transform: translateY(0px); } 100% { transform: translateY(-3px); } }
        @keyframes waddle { 0% { transform: rotate(-2deg); } 100% { transform: rotate(2deg); } }
        @keyframes glide { 0% { transform: translateY(0px) translateX(0px); } 100% { transform: translateY(-5px) translateX(2px); } }
        @keyframes enemySwim { 0% { transform: translateX(0px) translateY(0px); } 100% { transform: translateX(-2px) translateY(2px); } }
        @keyframes bossShake { 0%, 100% { transform: translateX(0px); } 25% { transform: translateX(-3px); } 75% { transform: translateX(3px); } }
        @keyframes seaweed { 0%, 100% { transform: rotate(-2deg); } 50% { transform: rotate(2deg); } }
        .swim-anim { animation: swim 0.5s ease-in-out infinite alternate; }
        .waddle-anim { animation: waddle 0.8s ease-in-out infinite alternate; }
        .glide-anim { animation: glide 1s ease-in-out infinite alternate; }
        .enemy-swim { animation: enemySwim 0.6s ease-in-out infinite alternate; }
        .boss-shake { animation: bossShake 0.3s ease-in-out infinite; }
        .seaweed { animation: seaweed 2s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <script>
        let activeCharacter = null;
        let gameStarted = false;
        let position = { x: 100, y: 300 };
        let level = 1;
        let enemies = [];
        let bottles = [];
        let power = 100;
        let score = 0;
        let gameMessage = 'ë°©í–¥í‚¤ë¡œ ì´ë™, ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ê³µê²©!';
        let attacking = false;
        let messageTimeout = null;
        let enemyIdCounter = 1;
        let bottleIdCounter = 1;
        let isBossLevel = false;

        const characters = {
            pufferfish: { name: 'ë³µì–´', speed: 8, baseAttackRange: 80 },
            catfish: { name: 'ë©”ê¸°', speed: 10, baseAttackRange: 60 },
            hippo: { name: 'í•˜ë§ˆ', speed: 6, baseAttackRange: 100 },
            ray: { name: 'ê°€ì˜¤ë¦¬', speed: 9, baseAttackRange: 90 }
        };

        const keysPressed = {};

        const enemyTypes = {
            small: { color: '#ff6b6b', sizeMultiplier: 0.8, healthMultiplier: 0.8 },
            medium: { color: '#ff8c42', sizeMultiplier: 1.0, healthMultiplier: 1.0 },
            large: { color: '#ffa500', sizeMultiplier: 1.3, healthMultiplier: 1.5 },
            giant: { color: '#ff4500', sizeMultiplier: 1.6, healthMultiplier: 2.0 },
            boss: { color: '#1a1a1a', sizeMultiplier: 2.5, healthMultiplier: 5.0 }
        };

        function getAttackRange() {
            const currentChar = characters[activeCharacter];
            const powerBonus = (power - 100) * 0.5;
            return currentChar.baseAttackRange + powerBonus;
        }

        function getEnemyTypeForLevel(lvl, index) {
            if (lvl % 10 === 0) return 'boss';
            if (lvl >= 10) return index === 0 ? 'giant' : (Math.random() > 0.3 ? 'large' : 'medium');
            if (lvl >= 7) return Math.random() > 0.5 ? 'large' : 'medium';
            if (lvl >= 4) return Math.random() > 0.3 ? 'medium' : 'small';
            return 'small';
        }

        function spawnEnemiesForLevel(lvl) {
            enemies = [];
            isBossLevel = (lvl % 10 === 0);
            
            if (isBossLevel) {
                const bossType = enemyTypes['boss'];
                enemies.push({
                    id: enemyIdCounter++,
                    x: 400, y: 300,
                    health: 15 + lvl * 3,
                    maxHealth: 15 + lvl * 3,
                    size: bossType.sizeMultiplier,
                    type: 'boss',
                    color: bossType.color
                });
            } else {
                const enemyCount = 2 + lvl;
                for (let i = 0; i < enemyCount; i++) {
                    const enemyType = getEnemyTypeForLevel(lvl, i);
                    const typeData = enemyTypes[enemyType];
                    const baseHealth = 2 + lvl;
                    enemies.push({
                        id: enemyIdCounter++,
                        x: 300 + Math.random() * 400,
                        y: 100 + Math.random() * 400,
                        health: Math.floor(baseHealth * typeData.healthMultiplier),
                        maxHealth: Math.floor(baseHealth * typeData.healthMultiplier),
                        size: typeData.sizeMultiplier + (lvl * 0.1),
                        type: enemyType,
                        color: typeData.color
                    });
                }
            }
        }

        function spawnBottlesForLevel(lvl) {
            bottles = [];
            const bottleCount = 2 + Math.floor(lvl / 2);
            for (let i = 0; i < bottleCount; i++) {
                bottles.push({
                    id: bottleIdCounter++,
                    x: 200 + Math.random() * 400,
                    y: 100 + Math.random() * 400,
                    collected: false
                });
            }
        }

        function levelUp() {
            level++;
            if (level % 10 === 0) {
                setGameMessage(`ğŸ¦ˆ ë ˆë²¨ ${level} - ë³´ìŠ¤ ë“±ì¥! ìƒì–´ë¥¼ ë¬¼ë¦¬ì³ë¼!`);
            } else {
                setGameMessage(`ğŸŠ ë ˆë²¨ ${level}! ë” ê°•ë ¥í•œ ì ë“¤ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!`);
            }
            spawnEnemiesForLevel(level);
            spawnBottlesForLevel(level);
        }

        spawnEnemiesForLevel(1);
        spawnBottlesForLevel(1);

        function getCharacterSVG(type, size = 50) {
            const svgs = {
                pufferfish: `<svg width="${size}" height="${size}" viewBox="-50 -50 100 100" class="animate-bounce">
                    <circle cx="0" cy="0" r="40" fill="#f4a460" opacity="0.9"/>
                    <circle cx="-12" cy="-8" r="6" fill="#2d1810"/><circle cx="12" cy="-8" r="6" fill="#2d1810"/>
                    <circle cx="-10" cy="-6" r="2" fill="white"/><circle cx="14" cy="-6" r="2" fill="white"/>
                    <path d="M -8 8 Q 0 12 8 8" stroke="#2d1810" stroke-width="2" fill="none"/>
                    <line x1="-28" y1="-20" x2="-40" y2="-28" stroke="#8b6914" stroke-width="2"/>
                    <line x1="-20" y1="-32" x2="-24" y2="-48" stroke="#8b6914" stroke-width="2"/>
                    <line x1="0" y1="-36" x2="0" y2="-52" stroke="#8b6914" stroke-width="2"/>
                    <line x1="20" y1="-32" x2="24" y2="-48" stroke="#8b6914" stroke-width="2"/>
                    <line x1="28" y1="-20" x2="40" y2="-28" stroke="#8b6914" stroke-width="2"/>
                </svg>`,
                catfish: `<svg width="${size}" height="${size * 0.8}" viewBox="-60 -30 120 60" class="swim-anim">
                    <ellipse cx="0" cy="0" rx="48" ry="20" fill="#6b5b4d" opacity="0.9"/>
                    <circle cx="-16" cy="-4" r="5" fill="#2d1810"/><circle cx="16" cy="-4" r="5" fill="#2d1810"/>
                    <circle cx="-14" cy="-3" r="2" fill="white"/><circle cx="18" cy="-3" r="2" fill="white"/>
                    <path d="M -32 4 Q -44 8 -52 16" stroke="#4a3d32" stroke-width="2.5" fill="none"/>
                    <path d="M -28 8 Q -36 16 -40 24" stroke="#4a3d32" stroke-width="2.5" fill="none"/>
                    <path d="M 32 4 Q 44 8 52 16" stroke="#4a3d32" stroke-width="2.5" fill="none"/>
                    <path d="M 28 8 Q 36 16 40 24" stroke="#4a3d32" stroke-width="2.5" fill="none"/>
                    <path d="M -48 0 L -64 -8 L -64 8 Z" fill="#6b5b4d" opacity="0.9"/>
                </svg>`,
                hippo: `<svg width="${size * 1.2}" height="${size}" viewBox="-70 -50 140 100" class="waddle-anim">
                    <ellipse cx="0" cy="0" rx="56" ry="36" fill="#6d5a6d" opacity="0.9"/>
                    <ellipse cx="0" cy="-20" rx="40" ry="28" fill="#7d6a7d" opacity="0.9"/>
                    <circle cx="-12" cy="-24" r="6" fill="#2d1810"/><circle cx="12" cy="-24" r="6" fill="#2d1810"/>
                    <circle cx="-10" cy="-23" r="2" fill="white"/><circle cx="14" cy="-23" r="2" fill="white"/>
                    <ellipse cx="-28" cy="-36" rx="10" ry="6" fill="#7d6a7d" opacity="0.9"/>
                    <ellipse cx="28" cy="-36" rx="10" ry="6" fill="#7d6a7d" opacity="0.9"/>
                    <ellipse cx="0" cy="-8" rx="16" ry="10" fill="#9d8a9d" opacity="0.9"/>
                    <circle cx="-6" cy="-10" r="3" fill="#2d1810"/><circle cx="6" cy="-10" r="3" fill="#2d1810"/>
                    <rect x="-40" y="24" width="16" height="20" fill="#6d5a6d" opacity="0.9" rx="4"/>
                    <rect x="-16" y="24" width="16" height="20" fill="#6d5a6d" opacity="0.9" rx="4"/>
                    <rect x="0" y="24" width="16" height="20" fill="#6d5a6d" opacity="0.9" rx="4"/>
                    <rect x="24" y="24" width="16" height="20" fill="#6d5a6d" opacity="0.9" rx="4"/>
                </svg>`,
                ray: `<svg width="${size * 1.5}" height="${size}" viewBox="-80 -40 160 80" class="glide-anim">
                    <ellipse cx="0" cy="0" rx="64" ry="32" fill="#4a7c9e" opacity="0.9"/>
                    <path d="M -64 -8 Q -80 -4 -88 8" fill="#4a7c9e" opacity="0.8"/>
                    <path d="M 64 -8 Q 80 -4 88 8" fill="#4a7c9e" opacity="0.8"/>
                    <circle cx="-8" cy="-4" r="5" fill="#2d1810"/><circle cx="8" cy="-4" r="5" fill="#2d1810"/>
                    <circle cx="-6" cy="-3" r="2" fill="white"/><circle cx="10" cy="-3" r="2" fill="white"/>
                    <path d="M 0 32 Q -4 44 -6 56" stroke="#4a7c9e" stroke-width="3" fill="none"/>
                    <circle cx="-24" cy="0" r="6" fill="#2d4a5c" opacity="0.5"/>
                    <circle cx="-12" cy="8" r="5" fill="#2d4a5c" opacity="0.5"/>
                    <circle cx="12" cy="8" r="5" fill="#2d4a5c" opacity="0.5"/>
                    <circle cx="24" cy="0" r="6" fill="#2d4a5c" opacity="0.5"/>
                </svg>`
            };
            return svgs[type] || '';
        }

        function createBottleSVG() {
            return `<svg width="35" height="55" viewBox="0 0 35 55" class="animate-pulse">
                <defs>
                    <linearGradient id="bottleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#4ade80;stop-opacity:0.95" />
                        <stop offset="100%" style="stop-color:#22c55e;stop-opacity:0.95" />
                    </linearGradient>
                    <radialGradient id="glow">
                        <stop offset="0%" style="stop-color:#4ade80;stop-opacity:0.6" />
                        <stop offset="100%" style="stop-color:#22c55e;stop-opacity:0" />
                    </radialGradient>
                </defs>
                <ellipse cx="17.5" cy="45" rx="20" ry="8" fill="url(#glow)"/>
                <rect x="10" y="15" width="15" height="33" rx="2" fill="url(#bottleGrad)" stroke="#16a34a" stroke-width="0.5"/>
                <rect x="12" y="10" width="11" height="6" rx="1" fill="#22c55e" stroke="#16a34a" stroke-width="0.5"/>
                <ellipse cx="17.5" cy="10" rx="5.5" ry="2" fill="#4ade80" opacity="0.8"/>
                <rect x="11" y="20" width="13" height="22" rx="1" fill="#86efac" opacity="0.3"/>
                <text x="17.5" y="32" font-size="6" fill="white" text-anchor="middle" font-weight="bold" font-family="Arial">ì°¸ì´ìŠ¬</text>
                <circle cx="14" cy="25" r="1.5" fill="white" opacity="0.6"/>
                <circle cx="20" cy="38" r="1" fill="white" opacity="0.5"/>
            </svg>`;
        }

        function createEnemySVG(enemy) {
            const { size, color, type } = enemy;
            if (type === 'boss') {
                return `<svg width="${80 * size}" height="${50 * size}" viewBox="-60 -30 120 60" class="boss-shake">
                    <ellipse cx="5" cy="0" rx="50" ry="22" fill="${color}" opacity="0.95"/>
                    <path d="M -10 -22 L 0 -40 L 10 -22 Z" fill="#2a2a2a" opacity="0.9"/>
                    <path d="M -50 0 L -75 -20 L -70 0 L -75 20 Z" fill="${color}" opacity="0.95"/>
                    <circle cx="25" cy="-8" r="5" fill="#ff0000" opacity="0.9"/>
                    <circle cx="27" cy="-9" r="2" fill="#ffff00"/>
                    <path d="M 40 -5 L 55 0 L 40 5 Z" fill="#3a3a3a"/>
                    <line x1="45" y1="-3" x2="50" y2="-1" stroke="white" stroke-width="2"/>
                    <line x1="45" y1="3" x2="50" y2="1" stroke="white" stroke-width="2"/>
                </svg>`;
            }
            return `<svg width="${40 * size}" height="${28 * size}" viewBox="-30 -20 60 40" class="enemy-swim">
                <ellipse cx="0" cy="0" rx="24" ry="16" fill="${color}" opacity="0.9"/>
                <circle cx="-8" cy="-4" r="4" fill="#2d1810"/><circle cx="8" cy="-4" r="4" fill="#2d1810"/>
                <circle cx="-7" cy="-5" r="1.5" fill="white"/><circle cx="9" cy="-5" r="1.5" fill="white"/>
                <path d="M 24 0 L 34 -8 L 34 8 Z" fill="${color}" opacity="0.8"/>
            </svg>`;
        }

        function createSeaweed(x, h) {
            return `<svg class="seaweed" style="position:absolute;left:${x}px;bottom:0;transform-origin:bottom center;" width="30" height="${h}" viewBox="0 0 30 ${h}">
                <path d="M 15 ${h} Q 10 ${h*0.7} 15 ${h*0.5} Q 20 ${h*0.3} 15 0" fill="none" stroke="#1a5c3a" stroke-width="8" opacity="0.7"/>
                <path d="M 15 ${h} Q 12 ${h*0.7} 15 ${h*0.5} Q 18 ${h*0.3} 15 0" fill="none" stroke="#22853f" stroke-width="5" opacity="0.8"/>
            </svg>`;
        }

        function createShell(x, y, size) {
            return `<svg style="position:absolute;left:${x}px;top:${y}px;" width="${size}" height="${size*0.7}" viewBox="0 0 40 28">
                <ellipse cx="20" cy="20" rx="18" ry="14" fill="#d4a373" opacity="0.9"/>
                <ellipse cx="20" cy="20" rx="15" ry="11" fill="#e8c5a0" opacity="0.8"/>
                <path d="M 5 20 Q 20 10 35 20" fill="none" stroke="#b8906d" stroke-width="1" opacity="0.6"/>
                <path d="M 8 20 Q 20 13 32 20" fill="none" stroke="#b8906d" stroke-width="1" opacity="0.6"/>
                <path d="M 11 20 Q 20 16 29 20" fill="none" stroke="#b8906d" stroke-width="1" opacity="0.6"/>
            </svg>`;
        }

        function checkCollisions() {
            bottles.forEach(bottle => {
                if (!bottle.collected) {
                    const distance = Math.sqrt((position.x - bottle.x)**2 + (position.y - bottle.y)**2);
                    if (distance < 40) {
                        bottle.collected = true;
                        power += 20;
                        score += 100;
                        setGameMessage(`âš¡ ì°¸ì´ìŠ¬ íŒŒì›Œì—…! íŒŒì›Œ: ${power} (+20)`);
                    }
                }
            });
            
            enemies.forEach(enemy => {
                const distance = Math.sqrt((position.x - enemy.x)**2 + (position.y - enemy.y)**2);
                if (distance < 30 * enemy.size) {
                    score = Math.max(0, score - 50);
                    setGameMessage('âŒ ì¶©ëŒ! -50ì ');
                }
            });
        }

        function attack() {
            if (attacking) return;
            attacking = true;
            setTimeout(() => { attacking = false; render(); }, 300);

            const attackPower = Math.floor(power / 50);
            const attackRange = getAttackRange();
            
            enemies = enemies.filter(enemy => {
                const distance = Math.sqrt((position.x - enemy.x)**2 + (position.y - enemy.y)**2);
                if (distance < attackRange) {
                    enemy.health -= attackPower;
                    if (enemy.health <= 0) {
                        const points = (enemy.type === 'boss' ? 1000 : 200) * level;
                        score += points;
                        setGameMessage(enemy.type === 'boss' ? `ğŸ¦ˆ ë³´ìŠ¤ ê²©íŒŒ! +${points}ì !` : `ğŸ’¥ ê²©íŒŒ! +${points}ì `);
                        return false;
                    }
                }
                return true;
            });

            if (enemies.length === 0) {
                setTimeout(() => levelUp(), 1500);
            }
        }

        function setGameMessage(msg) {
            gameMessage = msg;
            if (messageTimeout) clearTimeout(messageTimeout);
            messageTimeout = setTimeout(() => { gameMessage = ''; render(); }, 2000);
            render();
        }

        function startGame(character) {
            activeCharacter = character;
            gameStarted = true;
            level = 1;
            score = 0;
            power = 100;
            position = { x: 100, y: 300 };
            spawnEnemiesForLevel(1);
            spawnBottlesForLevel(1);
            render();
        }

        function showCharacterSelection() {
            document.getElementById('game-container').innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-blue-900 via-blue-800 to-blue-950 p-4">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl md:text-5xl font-bold text-cyan-300 mb-4 animate-pulse">ì•„ì¿ ì•„ë¦¬ì›€ ì¹œêµ¬ë“¤</h1>
                        <p class="text-cyan-200 text-xl md:text-2xl mb-2">ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
                        <p class="text-cyan-300 text-sm md:text-base">ê° ìºë¦­í„°ë§ˆë‹¤ ë‹¤ë¥¸ ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆì–´ìš”</p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 max-w-4xl">
                        ${Object.entries(characters).map(([key, char]) => `
                            <button onclick="startGame('${key}')" 
                                class="bg-gradient-to-b from-blue-600 to-blue-800 hover:from-cyan-500 hover:to-cyan-700 p-6 rounded-xl transition-all transform hover:scale-110 active:scale-95 shadow-2xl border-4 border-cyan-400">
                                <div class="flex justify-center mb-4">
                                    ${getCharacterSVG(key, 80)}
                                </div>
                                <div class="text-white font-bold text-2xl mb-3">${char.name}</div>
                                <div class="text-cyan-200 text-sm space-y-1">
                                    <div>âš¡ ì†ë„: ${char.speed}</div>
                                    <div>ğŸ¯ ê³µê²©ë²”ìœ„: ${char.baseAttackRange}</div>
                                    <div class="text-yellow-300 mt-2">
                                        ${key === 'pufferfish' ? 'ğŸ¦” ê°€ì‹œ ê³µê²©' : ''}
                                        ${key === 'catfish' ? 'ğŸ’¨ ë¹ ë¥¸ ëŒì§„' : ''}
                                        ${key === 'hippo' ? 'ğŸ’ª ê°•ë ¥í•œ í˜' : ''}
                                        ${key === 'ray' ? 'âš¡ ì „ê¸° ì¶©ê²©' : ''}
                                    </div>
                                </div>
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="mt-8 text-center text-cyan-200 text-sm md:text-base max-w-2xl">
                        <p class="mb-2">ğŸ® <strong>ê²Œì„ ë°©ë²•</strong></p>
                        <p>ë°©í–¥í‚¤ë¡œ ì´ë™í•˜ê³  ìŠ¤í˜ì´ìŠ¤ë°”(ë˜ëŠ” ê³µê²© ë²„íŠ¼)ë¡œ ê³µê²©í•˜ì„¸ìš”!</p>
                        <p>ğŸ¾ ì°¸ì´ìŠ¬ì„ ë¨¹ìœ¼ë©´ íŒŒì›Œê°€ ì˜¬ë¼ê°€ìš”! (íŒŒì›Œ +20)</p>
                        <p>ğŸ¦ˆ 10ë ˆë²¨ë§ˆë‹¤ ë³´ìŠ¤ ìƒì–´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤!</p>
                    </div>
                </div>
            `;
        }

        function render() {
            if (!gameStarted) {
                showCharacterSelection();
                return;
            }
            
            const attackRange = getAttackRange();
            const attackPower = Math.floor(power / 50);
            const isMobile = window.innerWidth < 850;
            const gameWidth = isMobile ? window.innerWidth - 20 : 800;
            const gameHeight = isMobile ? Math.min(window.innerHeight - 350, 500) : 600;
            
            document.getElementById('game-container').innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-blue-900 via-blue-800 to-blue-950 p-2">
                    <div class="text-center mb-2">
                        <h1 class="text-3xl md:text-4xl font-bold text-cyan-300 mb-1">ì•„ì¿ ì•„ë¦¬ì›€ ì¹œêµ¬ë“¤</h1>
                        <p class="text-cyan-200 text-sm">${isBossLevel ? 'âš ï¸ ë³´ìŠ¤ ë ˆë²¨ âš ï¸' : 'ë ˆë²¨: ' + level}</p>
                    </div>
                    <div class="relative bg-gradient-to-b from-blue-700 to-blue-900 rounded-lg shadow-2xl overflow-hidden" style="width:${gameWidth}px;height:${gameHeight}px;">
                        <div class="absolute inset-0 opacity-20">${Array(20).fill(0).map((_, i) => 
                            `<div class="absolute w-1 h-1 bg-cyan-300 rounded-full animate-pulse" style="left:${Math.random()*100}%;top:${Math.random()*100}%;animation-delay:${Math.random()*2}s"></div>`
                        ).join('')}</div>
                        
                        ${createSeaweed(isMobile ? 20 : 50, isMobile ? 100 : 150)}
                        ${createSeaweed(isMobile ? 60 : 120, isMobile ? 120 : 180)}
                        ${isMobile ? '' : createSeaweed(700, 160)}
                        ${isMobile ? '' : createSeaweed(750, 140)}
                        ${createShell(isMobile ? 80 : 150, gameHeight - 60, isMobile ? 25 : 35)}
                        ${isMobile ? '' : createShell(300, 555, 28)}
                        ${isMobile ? '' : createShell(600, 550, 32)}
                        ${createShell(gameWidth - (isMobile ? 80 : 120), gameHeight - 55, isMobile ? 22 : 30)}
                        
                        <div class="absolute top-2 right-2 ${isBossLevel?'bg-red-600 animate-pulse':'bg-purple-600'} text-white px-2 py-1 rounded-lg font-bold text-sm md:text-xl">
                            ${isBossLevel ? 'ğŸ¦ˆ BOSS' : 'LV ' + level}
                        </div>
                        <div class="absolute transition-all duration-100 ${attacking?'scale-125':'scale-100'}" style="left:${position.x * gameWidth / 800}px;top:${position.y * gameHeight / 600}px;transform:translate(-50%,-50%);">
                            ${getCharacterSVG(activeCharacter, isMobile ? 35 : 50)}
                            ${attacking ? `<div class="absolute rounded-full bg-yellow-300 opacity-30 animate-ping" style="width:${attackRange*2*gameWidth/800}px;height:${attackRange*2*gameHeight/600}px;left:50%;top:50%;transform:translate(-50%,-50%);"></div>` : ''}
                        </div>
                        ${bottles.map(b => !b.collected ? `<div class="absolute" style="left:${b.x * gameWidth / 800}px;top:${b.y * gameHeight / 600}px;transform:translate(-50%,-50%);">
                            ${createBottleSVG()}
                        </div>` : '').join('')}
                        ${enemies.map(e => `<div class="absolute" style="left:${e.x * gameWidth / 800}px;top:${e.y * gameHeight / 600}px;transform:translate(-50%,-50%);">
                            ${createEnemySVG(e)}
                            <div class="absolute" style="top:${-40*e.size}px;left:50%;transform:translateX(-50%);width:${70*e.size}px;">
                                <div class="bg-gray-800 rounded-full h-2 overflow-hidden mb-1">
                                    <div class="${e.type==='boss'?'bg-red-600':'bg-red-500'} h-full transition-all" style="width:${(e.health/e.maxHealth)*100}%"></div>
                                </div>
                                <div class="text-red-400 text-xs font-bold text-center">${e.health}</div>
                            </div>
                        </div>`).join('')}
                        ${gameMessage ? `<div class="absolute top-12 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-80 text-white px-4 py-2 rounded-lg text-center animate-pulse z-10 text-xs md:text-base max-w-xs">${gameMessage}</div>` : ''}
                    </div>
                    <div class="w-full max-w-4xl mt-2 bg-blue-900 bg-opacity-50 rounded-lg p-2 md:p-4">
                        <div class="grid grid-cols-5 gap-2 mb-2 text-xs md:text-base">
                            <div class="text-center"><div class="text-cyan-300 font-bold">ë ˆë²¨</div><div class="text-white text-lg md:text-2xl">${level}</div></div>
                            <div class="text-center"><div class="text-cyan-300 font-bold">ì ìˆ˜</div><div class="text-white text-lg md:text-2xl">${score}</div></div>
                            <div class="text-center"><div class="text-cyan-300 font-bold">íŒŒì›Œ</div><div class="text-white text-lg md:text-2xl">${power}</div></div>
                            <div class="text-center"><div class="text-cyan-300 font-bold">ê³µê²©ë ¥</div><div class="text-white text-lg md:text-2xl">${attackPower}</div></div>
                            <div class="text-center"><div class="text-cyan-300 font-bold">ì </div><div class="text-white text-lg md:text-2xl">${enemies.length}</div></div>
                        </div>
                        <div class="mb-2"><div class="text-cyan-300 font-bold mb-1 text-center text-xs md:text-base">ìºë¦­í„°: ${characters[activeCharacter].name}</div>
                        <div class="text-center text-cyan-200 text-xs mb-2 hidden md:block">
                            <p>â¬†ï¸â¬‡ï¸â¬…ï¸â¡ï¸ ë°©í–¥í‚¤ë¡œ ì´ë™ | âµ ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ê³µê²©</p>
                            <p class="mt-1">ğŸ¾ ì°¸ì´ìŠ¬: íŒŒì›Œ +20! | ğŸ  ì  ì¶©ëŒ: -50ì  | ğŸ¦ˆ 10ë ˆë²¨ë§ˆë‹¤ ë³´ìŠ¤!</p>
                        </div>
                        <div class="md:hidden text-center text-cyan-200 text-xs mb-2">
                            <p>ğŸ¾ ì°¸ì´ìŠ¬: íŒŒì›Œ +20! | ğŸ  ì  ì¶©ëŒ: -50ì  | ğŸ¦ˆ 10ë ˆë²¨ ë³´ìŠ¤!</p>
                        </div>
                        <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto md:hidden">
                            <div></div>
                            <button onmousedown="startMove('up', event)" onmouseup="stopMove(event)" ontouchstart="startMove('up', event)" ontouchend="stopMove(event)" class="bg-blue-600 active:bg-blue-700 text-white font-bold py-3 rounded-lg text-2xl active:scale-95 transition-all touch-manipulation select-none">â¬†ï¸</button>
                            <div></div>
                            <button onmousedown="startMove('left', event)" onmouseup="stopMove(event)" ontouchstart="startMove('left', event)" ontouchend="stopMove(event)" class="bg-blue-600 active:bg-blue-700 text-white font-bold py-3 rounded-lg text-2xl active:scale-95 transition-all touch-manipulation select-none">â¬…ï¸</button>
                            <button ontouchstart="event.preventDefault();attack()" onclick="attack()" class="bg-red-600 active:bg-red-700 text-white font-bold py-3 rounded-lg text-lg active:scale-95 transition-all touch-manipulation select-none">ê³µê²©</button>
                            <button onmousedown="startMove('right', event)" onmouseup="stopMove(event)" ontouchstart="startMove('right', event)" ontouchend="stopMove(event)" class="bg-blue-600 active:bg-blue-700 text-white font-bold py-3 rounded-lg text-2xl active:scale-95 transition-all touch-manipulation select-none">â¡ï¸</button>
                            <div></div>
                            <button onmousedown="startMove('down', event)" onmouseup="stopMove(event)" ontouchstart="startMove('down', event)" ontouchend="stopMove(event)" class="bg-blue-600 active:bg-blue-700 text-white font-bold py-3 rounded-lg text-2xl active:scale-95 transition-all touch-manipulation select-none">â¬‡ï¸</button>
                            <div></div>
                        </div>
                        <div class="hidden md:grid grid-cols-3 gap-2 max-w-xs mx-auto">
                            <div></div>
                            <button onmousedown="startMove('up', event)" onmouseup="stopMove(event)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg text-2xl active:scale-95 transition-all select-none">â¬†ï¸</button>
                            <div></div>
                            <button onmousedown="startMove('left', event)" onmouseup="stopMove(event)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg text-2xl active:scale-95 transition-all select-none">â¬…ï¸</button>
                            <button onclick="attack()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-lg text-xl active:scale-95 transition-all select-none">ê³µê²©</button>
                            <button onmousedown="startMove('right', event)" onmouseup="stopMove(event)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg text-2xl active:scale-95 transition-all select-none">â¡ï¸</button>
                            <div></div>
                            <button onmousedown="startMove('down', event)" onmouseup="stopMove(event)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg text-2xl active:scale-95 transition-all select-none">â¬‡ï¸</button>
                            <div></div>
                        </div>
                    </div>
                </div>
            `;
        }

        let touchDirection = null;

        function startMove(dir, event) {
            if(event) event.preventDefault();
            touchDirection = dir;
        }

        function stopMove(event) {
            if(event) event.preventDefault();
            touchDirection = null;
        }

        function movePlayer(dir) {
            if (!gameStarted) return;
            const currentChar = characters[activeCharacter];
            const isMobile = window.innerWidth < 850;
            const gameWidth = isMobile ? window.innerWidth - 20 : 800;
            const gameHeight = isMobile ? Math.min(window.innerHeight - 350, 500) : 600;
            const newPos = { ...position };
            if(dir==='up') newPos.y = Math.max(50, position.y - currentChar.speed);
            if(dir==='down') newPos.y = Math.min(gameHeight * 600 / gameHeight - 50, position.y + currentChar.speed);
            if(dir==='left') newPos.x = Math.max(30, position.x - currentChar.speed);
            if(dir==='right') newPos.x = Math.min(gameWidth * 800 / gameWidth - 30, position.x + currentChar.speed);
            position = newPos;
            checkCollisions();
            render();
        }

        document.addEventListener('keydown', e => {
            if (!gameStarted) return;
            if(e.key==='ArrowUp' || e.key==='ArrowDown' || e.key==='ArrowLeft' || e.key==='ArrowRight') {
                e.preventDefault();
            }
            keysPressed[e.key] = true;
            if(e.key===' ') { 
                e.preventDefault(); 
                attack(); 
            }
        });

        document.addEventListener('keyup', e => {
            delete keysPressed[e.key];
        });

        // ì—°ì† ì´ë™ ì²˜ë¦¬ (ê²Œì„ ë£¨í”„)
        setInterval(() => {
            if (!gameStarted || !activeCharacter) return;
            const currentChar = characters[activeCharacter];
            const isMobile = window.innerWidth < 850;
            const gameWidth = isMobile ? window.innerWidth - 20 : 800;
            const gameHeight = isMobile ? Math.min(window.innerHeight - 350, 500) : 600;
            let moved = false;

            // í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬
            if(keysPressed['ArrowUp']) {
                position.y = Math.max(50, position.y - currentChar.speed);
                moved = true;
            }
            if(keysPressed['ArrowDown']) {
                position.y = Math.min((gameHeight * 600 / gameHeight) - 50, position.y + currentChar.speed);
                moved = true;
            }
            if(keysPressed['ArrowLeft']) {
                position.x = Math.max(30, position.x - currentChar.speed);
                moved = true;
            }
            if(keysPressed['ArrowRight']) {
                position.x = Math.min((gameWidth * 800 / gameWidth) - 30, position.x + currentChar.speed);
                moved = true;
            }

            // í„°ì¹˜ ë²„íŠ¼ ì…ë ¥ ì²˜ë¦¬
            if(touchDirection === 'up') {
                position.y = Math.max(50, position.y - currentChar.speed);
                moved = true;
            }
            if(touchDirection === 'down') {
                position.y = Math.min((gameHeight * 600 / gameHeight) - 50, position.y + currentChar.speed);
                moved = true;
            }
            if(touchDirection === 'left') {
                position.x = Math.max(30, position.x - currentChar.speed);
                moved = true;
            }
            if(touchDirection === 'right') {
                position.x = Math.min((gameWidth * 800 / gameWidth) - 30, position.x + currentChar.speed);
                moved = true;
            }

            if(moved) {
                checkCollisions();
                render();
            }
        }, 50);

        setInterval(() => {
            enemies = enemies.map(enemy => {
                const dx = position.x - enemy.x, dy = position.y - enemy.y, d = Math.sqrt(dx*dx + dy*dy);
                if(d < 200) return {...enemy, x:enemy.x+(dx/d)*(1.5+level*0.2), y:enemy.y+(dy/d)*(1.5+level*0.2)};
                return enemy;
            });
            render();
        }, 100);

        render();
    </script>
</body>
</html>